# Athlete Registration Contract

paths:
  /athletes:
    post:
      operationId: createAthlete
      summary: Register a new athlete
      description: |
        Registers a new athlete under a specific school.
        
        **Business Rules:**
        - **Age & Category Mapping:**
          - U14: 10-13 years
          - U17: 14-16 years
          - U19: 17-19 years
        - **Bib Number**: Generated automatically by the server upon registration.
      tags:
        - Athletes
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAthleteRequest'
            examples:
              valid_u14:
                summary: Valid U14 Athlete
                value:
                  name: "Alice Runner"
                  age: 12
                  gender: "FEMALE"
                  category: "U14"
                  schoolId: "550e8400-e29b-41d4-a716-446655440000"
                  personalBest: "12.5s"
      responses:
        '201':
          description: Athlete registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AthleteResponse'
        '400':
          description: Invalid request or business rule violation
          content:
            application/json:
              schema:
                $ref: '../openapi.yaml#/components/schemas/Error'
              examples:
                age_category_mismatch:
                  summary: Age/Category Mismatch
                  value:
                    statusCode: 400
                    message: "Age 15 does not match category U14 (requires 10-13)"
                    error: "Bad Request"
        '422':
          description: Validation failed
          content:
            application/json:
              schema:
                $ref: '../openapi.yaml#/components/schemas/ValidationError'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../openapi.yaml#/components/schemas/Error'

components:
  schemas:
    # ─────────────────────────────────────────────────────────────────
    # Request Schema
    # ─────────────────────────────────────────────────────────────────
    CreateAthleteRequest:
      type: object
      required:
        - name
        - age
        - gender
        - category
        - schoolId
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
          description: Full name of the athlete
          example: "Alice Runner"
        age:
          type: integer
          minimum: 10
          maximum: 19
          description: Age of the athlete (must be between 10 and 19)
          example: 12
        gender:
          type: string
          enum: [MALE, FEMALE]
          description: Gender of the athlete
          example: "FEMALE"
        category:
          type: string
          enum: [U14, U17, U19]
          description: |
            Competition category. Reference rules for age limits.
          example: "U14"
        schoolId:
          type: string
          format: uuid
          description: ID of the school the athlete represents
          example: "550e8400-e29b-41d4-a716-446655440000"
        personalBest:
          type: string
          description: Optional records (e.g., "10.5s" or "5.2m")
          example: "12.5s"

    # ─────────────────────────────────────────────────────────────────
    # Response Schema
    # ─────────────────────────────────────────────────────────────────
    AthleteResponse:
      type: object
      required:
        - id
        - bibNumber
        - name
        - age
        - gender
        - category
        - schoolId
        - createdAt
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the athlete
          example: "a1b2c3d4-e5f6-41d4-a716-446655440000"
        bibNumber:
          type: integer
          description: |
            Unique bib key generated by the system.
            Strategy: Auto-incrementing integer or seeded random unique value.
          example: 101
        name:
          type: string
          description: Full name of the athlete
        age:
          type: integer
        gender:
          type: string
          enum: [MALE, FEMALE]
        category:
          type: string
          enum: [U14, U17, U19]
        schoolId:
          type: string
          format: uuid
        personalBest:
          type:
            - string
            - 'null'
          description: Optional records (e.g., "10.5s" or "5.2m")
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
